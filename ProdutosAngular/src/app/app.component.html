<div class="container-fluid" style="padding-left: 20px; padding-right: 20px;">
  <div class="div-banner bg-dark border border-5 border-secondary rounded-top-5 d-flex bg-gradient" style="height: 180px;">

    <div
      *ngIf="mostrarPerfil; else divVazia"
      class="perfil-div d-flex flex-column justify-content-between align-items-center border border-2 border-secondary rounded-top-5"
      style="width: 13%; height: 100%;">
      <!-- Botão de logout -->
      <button type="button" class="btn btn-danger mt-2 logout-button" (click)="logout()">SAIR</button>
      <!-- Foto e nome do usuário -->
      <div class="d-flex flex-column align-items-center">
        <img
          [src]="usuarioLogado.imagem ? 'data:image/jpeg;base64,' + usuarioLogado.imagem : '/foto_perfil.png'" alt="Foto do usuário" [width]="isMobileOrTablet ? 70 : 100" [height]="isMobileOrTablet ? 70 : 100">
        <span class="text-white mt-2" style="font-size: 16px;">{{usuarioLogado.login}}</span>
      </div>
    </div>

    <ng-template #divVazia>
      <div
        class="perfil-div d-flex flex-column justify-content-between align-items-center"
        style="width: 13%; height: 100%; background-color: transparent;">
      </div>
    </ng-template>

    <!-- Coluna para o título e botões de navegação (80%) -->
    <div class="w-100 ps-3 d-flex flex-column justify-content-center" style="height: 100%; margin-left: -115px;" [ngClass]="{'centralizado': !mostrarPerfil}">
      <div id="div_banner_menu">

        <!-- Botões de navegação -->
        <div *ngIf="!isMobileOrTablet">
          <h2 class="text-center text-white position-relative" style="line-height: 1.2;">
          <span style="color: red; font-size: 60px; font-family: 'Leckerli One', cursive;">P<span style="color: red; font-size: 30px; font-family: 'Merienda', cursive">RO</span>
          <span style="color: white; font-size: 30px; font-family: 'Merienda', cursive">DIFY</span>
          </span>
          </h2>
          <ul class="text-center list-inline py-1" style="font-size: 14px;">
            <li class="list-inline-item">
              <a routerLink="/login" class="btn btn-outline-secondary fw-bold">Início</a>
            </li>
            <li class="list-inline-item">
              <div class="btn-group">
                <button type="button" class="btn btn-outline-secondary fw-bold dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                  Gerenciar produtos
                </button>
                <div class="dropdown-menu">
                  <a class="dropdown-item" routerLink="/produtos">Listar produtos</a>
                  <a class="dropdown-item" routerLink="/addproduto">Cadastrar produtos</a>
                </div>
              </div>
            </li>
            <li class="list-inline-item">
              <div class="btn-group">
                <button type="button" class="btn btn-outline-secondary fw-bold dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                  Gerenciar fornecedores
                </button>
                <div class="dropdown-menu">
                  <a class="dropdown-item" routerLink="/geoloc">Localizar fornecedor</a>
                  <a class="dropdown-item" routerLink="/addfornecedor">Cadastrar fornecedor</a>
                  <a class="dropdown-item" routerLink="/listarfornecedores">Listar fornecedores</a>
                </div>
              </div>
            </li>
            <li class="list-inline-item">
              <a routerLink="/pdv" class="btn btn-outline-secondary fw-bold">Ponto de venda</a>
            </li>
            <li class="list-inline-item">
              <a routerLink="/sobreTab1" class="btn btn-outline-secondary fw-bold">Sobre</a>
            </li>
            <li class="list-inline-item">
              <a href="https://www.sistemaprodify.com/swagger-ui/index.html" target="_blank" class="btn btn-outline-secondary fw-bold">Swagger</a>
            </li>
          </ul>
        </div>

        <!-- Menu para mobile/tablet -->
        <div *ngIf="isMobileOrTablet" class="mobile-menu">
          <h2 class="text-center text-white position-relative" style="line-height: 1.2;">
          <span style="color: red; font-size: 60px; font-family: 'Leckerli One', cursive;">P<span style="color: red; font-size: 40px; font-family: 'Merienda', cursive">RO</span>
          <span style="color: white; font-size: 40px; font-family: 'Merienda', cursive">DIFY</span>
          </span>
          </h2>
          
          <!-- Overlay para escurecer o fundo -->
          <div class="menu-overlay" [class.active]="menuOpen" (click)="abrirFecharMenu()"></div>
          
          <!-- Botão de hambúrguer para abrir/fechar o menu -->
          <div class="botao-menu-celular">
            <button class="btn menu-mobile-btn" (click)="abrirFecharMenu()">
              &#9776;
            </button>
          </div>
          
          <!-- Menu que é exibido ao clicar no botão -->
          <div *ngIf="menuOpen" class="mobile-menu-options">
            <ul class="mdc-list">
              <li>
                <a routerLink="/login" (click)="abrirFecharMenu()">Início</a>
              </li>
              
              <!-- Submenu Produtos -->
              <li class="mobile-submenu">
                <div class="mobile-submenu-header" (click)="toggleSubmenu($event)">
                  <span>Gerenciar Produtos</span>
                  <span class="submenu-arrow">▼</span>
                </div>
                <ul class="mobile-submenu-items">
                  <li>
                    <a routerLink="/produtos" (click)="abrirFecharMenu()">Listar produtos</a>
                  </li>
                  <li>
                    <a routerLink="/addproduto" (click)="abrirFecharMenu()">Cadastrar produto</a>
                  </li>
                </ul>
              </li>
              <li>
                <a routerLink="/pdv" (click)="abrirFecharMenu()">Ponto de venda</a>
              </li>

              <!-- Submenu Fornecedores -->
              <li class="mobile-submenu">
                <div class="mobile-submenu-header" (click)="toggleSubmenu($event)">
                  <span>Gerenciar Fornecedores</span>
                  <span class="submenu-arrow">▼</span>
                </div>
                <ul class="mobile-submenu-items">
                  <li>
                    <a routerLink="/geoloc" (click)="abrirFecharMenu()">Localizar fornecedor</a>
                  </li>
                  <li>
                    <a routerLink="/addfornecedor" (click)="abrirFecharMenu()">Cadastrar fornecedor</a>
                  </li>
                  <li>
                    <a routerLink="/listarfornecedores" (click)="abrirFecharMenu()">Listar fornecedores</a>
                  </li>
                </ul>
              </li>
              <li>
                <a routerLink="/sobreTab1" (click)="abrirFecharMenu()">Sobre</a>
              </li>
              <li>
                <a href="https://www.sistemaprodify.com/swagger-ui/index.html" target="_blank" (click)="abrirFecharMenu()">Swagger</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div>
    <button id="btnTrocarTema" (click)="alternarTema()" class="btn btn-light-dark fw-bold">
      <i [class]="temaEscuro ? 'bi bi-sun' : 'bi bi-moon'"></i>
    </button>
    </div>
  </div>

  <!-- Barra personalizada -->
  <div class="custom-bar rounded-bottom-5">
    <div class="image-bar-container">
      <img src="/java_img.png" alt="Imagem 1" class="background-bar-image image-bar-1">
      <img src="/spring_img.png" alt="Imagem 2" class="background-bar-image image-bar-2">
      <img src="/angular_img.png" alt="Imagem 3" class="background-bar-image image-bar-3">
    </div>  
    <div class="text-bar">
      <span *ngIf="!isMobileOrTablet" style="font-size: 14px;">Deseja ter acesso ao código deste projeto? Ou saber mais sobre o sistema ou sobre o desenvolvedor? <a routerLink="/sobreTab2">Clique aqui!</a></span>
      <span *ngIf="isMobileOrTablet" style="font-size: 11px;">Acesse o GitHub do Prodify - <a routerLink="/sobreTab2">Clique aqui!</a></span>
    </div>
  </div>

  <router-outlet></router-outlet>

  <!-- Toast de redirecionamento (logo abaixo do banner, um pouco acima do centro) -->
  <ngb-toast
    *ngIf="showRedirectToast"
    [autohide]="true"
    [delay]="1500"
    class="bg-dark text-white position-fixed shadow"
    style="top: 40%; left: 50%; transform: translate(-50%, -50%); z-index: 1080;"
    (hidden)="showRedirectToast = false">
    {{ toastText }}
  </ngb-toast>

  <!-- Modal de expiração tratado nos components via catch; nenhum toast global aqui -->

  <div class="bg-dark border border-5 border-secondary position-relative">
    <div class="card-body text-center text-white">
      <div class="bg-gradient p-3">
        <div class="d-flex align-items-center">
          <img src="/whatsapp-logo.png" height="30" width="30" id="img-whats" class="ms-n2 me-3" />
          <div class="d-flex flex-wrap align-items-center">
            <span class="me-2 fonte-rodape">(41) 99539-7044 |</span>
            <span class="me-2 fonte-rodape">Acessos: {{numeroVisitas}} |</span>
            <span class="me-1 fonte-rodape"><a href="https://www.linkedin.com/in/matheus-reynard" target="_blank">Conheça o Desenvolvedor!</a></span>
          </div>
        </div>
      </div>
      <div class="position-absolute end-0 bottom-0 d-flex align-items-end">
        <img src="/logo_sacolas.png" alt="Logo" width="150" height="110">
      </div>
    </div>
  </div>
</div>
