<div class="card my-5">
  <div class="card-body">
    <form (ngSubmit)="onSubmit()" #fornecedorForm="ngForm">
      <div class="div-tabela">
        <table class="table table-bordered" style="width: 100%; table-layout: fixed;">
          <thead>
          <tr>
            <th colspan="6" class="text-center">Cadastrar um novo fornecedor</th>
          </tr>
          </thead>
          <tbody>
          <!-- Linha 1: Nome do Fornecedor, CEP e botão Buscar -->
          <tr>
            <td style="width: 16%;">
              <span style="color: red">* </span>
              <label for="nomeFornecedor" class="required">Nome do Fornecedor:</label>
            </td>
            <td style="width: 24%;">
              <input type="text" [(ngModel)]="nomeFornecedor"
                     class="form-control"
                     id="nomeFornecedor"
                     name="nomeFornecedor"
                     placeholder="Insira o nome do fornecedor."
                     required
                     #nomeFornecedorInput="ngModel"
                     [ngClass]="{'is-invalid': nomeFornecedorInput.invalid && nomeFornecedorInput.touched}"
                     maxlength="50">
              <div *ngIf="nomeFornecedorInput.invalid && nomeFornecedorInput.touched" class="invalid-feedback">
                O nome do fornecedor é obrigatório.
              </div>
            </td>
            <td style="width: 12%;">
              <span style="color: red">* </span>
              <label for="cep" class="required">CEP:</label>
            </td>
            <td style="width: 16%;">
              <input
                type="text"
                class="form-control"
                id="cep"
                name="cep"
                [(ngModel)]="endereco.cep"
                mask="00000-000"
                [showMaskTyped]="true"
                placeholder="00000-000"
                required
                #cepInput="ngModel"
                [ngClass]="{'is-invalid': cepInput.invalid && cepInput.touched}"
              />
              <div *ngIf="cepInput.invalid && cepInput.touched" class="invalid-feedback">
                O CEP é obrigatório.
              </div>
            </td>
            <td colspan="2" style="width: 12%;">
              <button type="button" class="btn btn-secondary" (click)="buscarEnderecoPorCep(endereco.cep)">Buscar</button>
            </td>
          </tr>

          <!-- Linha 2: Logradouro, Nº Residência, Complemento -->
          <tr>
            <td style="width: 16%;">
              <label for="logradouro">Logradouro:</label>
            </td>
            <td style="width: 24%;">
              <input type="text" [(ngModel)]="endereco.logradouro"
                     class="form-control"
                     id="logradouro"
                     name="logradouroFornecedor"
                     readonly>
            </td>
            <td style="width: 12%;">
              <label for="nrResidenciaFornecedor">Nº Residência:</label>
            </td>
            <td style="width: 16%;">
              <input type="text" [(ngModel)]="nrResidenciaFornecedor"
                     class="form-control"
                     id="nrResidenciaFornecedor"
                     name="nrResidenciaFornecedor"
                     placeholder="Número"
                     maxlength="10">
            </td>
            <td style="width: 12%;">
              <label for="complemento">Complemento:</label>
            </td>
            <td style="width: 20%;">
              <input type="text" [(ngModel)]="endereco.complemento"
                     class="form-control"
                     id="complemento"
                     name="complementoFornecedor">
            </td>
          </tr>

          <!-- Linha 3: Unidade e Bairro -->
          <tr>
            <td style="width: 16%;">
              <label for="unidade">Unidade:</label>
            </td>
            <td style="width: 24%;">
              <input type="text" [(ngModel)]="endereco.unidade"
                     class="form-control"
                     id="unidade"
                     name="unidadeFornecedor"
                     readonly>
            </td>
            <td style="width: 12%;">
              <label for="bairro">Bairro:</label>
            </td>
            <td colspan="3" style="width: 48%;">
              <input type="text" [(ngModel)]="endereco.bairro"
                     class="form-control"
                     id="bairro"
                     name="bairroFornecedor"
                     readonly>
            </td>
          </tr>

          <!-- Linha 4: Cidade, UF, Estado -->
          <tr>
            <td style="width: 16%;">
              <label for="localidade">Cidade:</label>
            </td>
            <td style="width: 24%;">
              <input type="text" [(ngModel)]="endereco.localidade"
                     class="form-control"
                     id="localidade"
                     name="localidadeFornecedor"
                     readonly>
            </td>
            <td style="width: 12%;">
              <label for="uf">UF:</label>
            </td>
            <td style="width: 16%;">
              <input type="text" [(ngModel)]="endereco.uf"
                     class="form-control"
                     id="uf"
                     name="ufFornecedor"
                     readonly>
            </td>
            <td style="width: 12%;">
              <label for="estado">Estado:</label>
            </td>
            <td style="width: 20%;">
              <input type="text" [(ngModel)]="endereco.estado"
                     class="form-control"
                     id="estado"
                     name="estadoFornecedor"
                     readonly>
            </td>
          </tr>

          <!-- Linha 5: Região, IBGE, GIA -->
          <tr>
            <td style="width: 16%;">
              <label for="regiao">Região:</label>
            </td>
            <td style="width: 24%;">
              <input type="text" [(ngModel)]="endereco.regiao"
                     class="form-control"
                     id="regiao"
                     name="regiaoFornecedor"
                     readonly>
            </td>
            <td style="width: 12%;">
              <label for="ibge">IBGE:</label>
            </td>
            <td style="width: 16%;">
              <input type="text" [(ngModel)]="endereco.ibge"
                     class="form-control"
                     id="ibge"
                     name="ibgeFornecedor"
                     readonly>
            </td>
            <td style="width: 12%;">
              <label for="gia">GIA:</label>
            </td>
            <td style="width: 20%;">
              <input type="text" [(ngModel)]="endereco.gia"
                     class="form-control"
                     id="gia"
                     name="giaFornecedor"
                     readonly>
            </td>
          </tr>

          <!-- Linha 6: DDD, SIAFI -->
          <tr>
            <td style="width: 16%;">
              <label for="ddd">DDD:</label>
            </td>
            <td style="width: 24%;">
              <input type="text" [(ngModel)]="endereco.ddd"
                     class="form-control"
                     id="ddd"
                     name="dddFornecedor"
                     readonly>
            </td>
            <td style="width: 12%;">
              <label for="siafi">SIAFI:</label>
            </td>
            <td colspan="3" style="width: 48%;">
              <input type="text" [(ngModel)]="endereco.siafi"
                     class="form-control"
                     id="siafi"
                     name="siafiFornecedor"
                     readonly>
            </td>
          </tr>

          <!-- Linha 7: Aviso -->
          <tr>
            <td colspan="6" style="width: 100%;">
              <span style="font-size: 14px; color: red"><strong>AVISO:</strong></span> <span style="font-size: 13px;"> Busque pelo CEP, então todos os campos serão preenchidos automaticamente. Após isso, informe o nome do fornecedor.</span>
            </td>
          </tr>

          <!-- Linha 8: Botão Cadastrar -->
          <tr>
            <td colspan="6" class="text-left" style="width: 100%;">
              <button type="submit" [disabled]="!fornecedorForm.form.valid" class="btn bg-primary-subtle fw-bold">Cadastrar</button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </form>
  </div>
</div>

<!-- Janela (modal) que abre depois de cadastrar um fornecedor -->
<ng-template #modalMsgAddFornecedor let-modal>
  <div class="modal-header">
    <h5 class="modal-title">
      Sucesso!
    </h5>
    <img ngSrc="/codigo_barras.png" height="60" width="60" class="img-right"/>
  </div>
  <div class="modal-body">
    <p>Fornecedor <b>ID: {{ novoFornecedor.id }} | Nome: {{ novoFornecedor.nome }}</b> cadastrado.</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.close()">Fechar</button>
  </div>
</ng-template>

<!-- Janela (modal) ERROS -->
<ng-template #modalMsgAviso let-modal>
  <div class="modal-header">
    <h5 class="modal-title">
      AVISO!
    </h5>
    <img ngSrc="/codigo_barras.png" height="60" width="60" class="img-right"/>
  </div>
  <div class="modal-body">
    <p>{{ mensagemErro }}</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.close()">Fechar</button>
  </div>
</ng-template>
