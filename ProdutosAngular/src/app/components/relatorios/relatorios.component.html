<div class="card my-4">
  <div class="card-body">
    <h5 class="mb-3">Relatório de transações econômicas</h5>

    <div class="d-flex justify-content-between align-items-center mb-2">
      <div class="h6 mb-0 text-secondary">Clique na coluna para ordenar</div>
      <button class="btn btn-outline-primary btn-sm" (click)="baixarPdf()">
        <i class="bi bi-file-earmark-pdf"></i>
        Exportar PDF
      </button>
    </div>

    <div *ngIf="transacoes.length === 0" class="text-muted">Nenhuma transação encontrada.</div>

    <div *ngIf="transacoes.length > 0" class="tabela-wrapper">
      <table class="table table-sm table-hover table-bordered relatorio-tabela">
        <colgroup>
          <col style="width: 12%;">
          <col style="width: 14%;">
          <col style="width: 10%;">
          <col style="width: 14%;">
          <col style="width: 16%;">
          <col style="width: 34%;">
        </colgroup>
        <thead>
          <tr>
            <th (click)="setSort('id')" class="sortable">ID <span [class]="'sort-indicator ' + getSortClass('id')"></span></th>
            <th (click)="setSort('tipo')" class="sortable">Tipo <span [class]="'sort-indicator ' + getSortClass('tipo')"></span></th>
            <th (click)="setSort('data')" class="sortable">Data <span [class]="'sort-indicator ' + getSortClass('data')"></span></th>
            <th class="text-end sortable" (click)="setSort('totalQuantidade')">Quantidade <span [class]="'sort-indicator ' + getSortClass('totalQuantidade')"></span></th>
            <th class="text-end sortable" (click)="setSort('totalValor')">Valor transação <span [class]="'sort-indicator ' + getSortClass('totalValor')"></span></th>
            <th class="text-end sortable" (click)="setSort('saldoApos')">Saldo final <span [class]="'sort-indicator ' + getSortClass('saldoApos')"></span></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of transacoesPaginadas; let i = index" [ngClass]="{ 'linha-venda': t.tipo === 'VENDA', 'linha-compra': t.tipo === 'COMPRA' }">
            <td>#{{ t.id }}</td>
            <td>{{ t.tipo === 'VENDA' ? 'Venda' : 'Compra' }}</td>
            <td class="text-muted">{{ t.data | date:'dd/MM/yyyy HH:mm' }}</td>
            <td class="text-end">{{ t.totalQuantidade }}</td>
            <td class="text-end">{{ t.totalValor | currency:'BRL':'symbol':'1.2-2' }}</td>
            <td class="text-end" [ngClass]="{ 'text-success': t.tipo === 'VENDA', 'text-danger': t.tipo === 'COMPRA' }">
              {{ getSaldoAposTransacaoGlobal(i) | currency:'BRL':'symbol':'1.2-2' }}
            </td>
          </tr>
        </tbody>
      </table>
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mt-2 gap-2">
        <div class="text-muted small">Total de registros: {{ totalRecords }}</div>
        <mat-paginator [length]="totalRecords"
                       [pageSize]="pageSize"
                       [pageIndex]="currentPage"
                       (page)="onPageChange($event)"
                       [pageSizeOptions]="[10, 20, 50]">
        </mat-paginator>
      </div>
    </div>
  </div>
</div>
